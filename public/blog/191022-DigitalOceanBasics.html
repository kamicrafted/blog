<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Setting up LEMP and HTTPS/SSL on Digital Ocean | Pixels &amp; Bits – Kamicrafted Blog</title>
    <meta name="description" content="">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon.png">
  <link rel="icon" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" sizes="16x16" href="/favicon-16x16.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#FF3E6C">
  <meta name="msapplication-TileColor" content="#FF3E6C">
  <meta name="theme-color" content="#ffffff">
    
    <link rel="preload" href="/assets/css/0.styles.89ae0d75.css" as="style"><link rel="preload" href="/assets/js/app.c1aa11cd.js" as="script"><link rel="preload" href="/assets/js/6.580d02f8.js" as="script"><link rel="preload" href="/assets/js/14.743a4d6c.js" as="script"><link rel="prefetch" href="/assets/js/1.90fbb397.js"><link rel="prefetch" href="/assets/js/10.c4d12f3b.js"><link rel="prefetch" href="/assets/js/11.d57fd274.js"><link rel="prefetch" href="/assets/js/12.19701de1.js"><link rel="prefetch" href="/assets/js/13.4d77b2f1.js"><link rel="prefetch" href="/assets/js/15.36a3a502.js"><link rel="prefetch" href="/assets/js/16.e6e5d95d.js"><link rel="prefetch" href="/assets/js/17.a4abe1c6.js"><link rel="prefetch" href="/assets/js/18.b27787c1.js"><link rel="prefetch" href="/assets/js/2.4d902713.js"><link rel="prefetch" href="/assets/js/3.bbd88c74.js"><link rel="prefetch" href="/assets/js/7.b1c3caf7.js"><link rel="prefetch" href="/assets/js/8.f3a557cc.js"><link rel="prefetch" href="/assets/js/9.54704419.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.c3d51be7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.89ae0d75.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar" data-v-0aa3c0fd><div class="sidebar-button" data-v-0aa3c0fd><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <div class="search-box" data-v-2e51bff4 data-v-0aa3c0fd><input aria-label="Search" autocomplete="off" spellcheck="false" value="" data-v-2e51bff4> <!----></div> <a href="/" class="home-link router-link-active" data-v-0aa3c0fd><img src="/logo-pixelsnbits.svg" alt="Pixels &amp; Bits – Kamicrafted Blog" class="logo" data-v-0aa3c0fd> <span class="site-name can-hide" data-v-0aa3c0fd>Pixels &amp; Bits – Kamicrafted Blog</span></a> <div class="links" style="max-width:nullpx;" data-v-0aa3c0fd><nav class="nav-links can-hide" data-v-0374d5f0 data-v-0aa3c0fd><div class="nav-item" data-v-0374d5f0><a href="/archive/" class="nav-link" data-v-0374d5f0>Archive</a></div><div class="nav-item" data-v-0374d5f0><a href="/rss.xml" class="nav-link" data-v-0374d5f0>
  RSS
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><h2 class="site-title">Pixels &amp; Bits – Kamicrafted Blog</h2> <nav class="nav-links" data-v-0374d5f0><div class="nav-item" data-v-0374d5f0><a href="/archive/" class="nav-link" data-v-0374d5f0>Archive</a></div><div class="nav-item" data-v-0374d5f0><a href="/rss.xml" class="nav-link" data-v-0374d5f0>
  RSS
</a></div> <!----></nav>  <!----> </div> <div class="post"><div class="hero hero--fullwidth"><div class="hero__scrim"></div> <div class="hero__image"><img src="/images/191022-digitalocean.jpg" alt class="hero__artwork"></div> <div class="blog__header"><p class="publish-date"><time datetime="2019-10-22 11:38:6">October 22, 2019</time></p> <h1 class="blog__title">Setting up LEMP and HTTPS/SSL on Digital Ocean</h1> <p class="read-time"><i data-feather="watch" class="icon icon-watch"></i>
        4 min read
      </p></div></div> <div class="blog"><!----> <div class="custom content__default"><h2 id="setting-up-ssl-certificates-using-let-s-encrypt-certbot"><a href="#setting-up-ssl-certificates-using-let-s-encrypt-certbot" aria-hidden="true" class="header-anchor">#</a> Setting up SSL Certificates using Let's Encrypt &amp; Certbot</h2> <p>To set up a free TLS/SSL certificate, we can use Certbot and Let's Encrypt to allow encrypted HTTPS on the web server. Certbot automates the process and makes registration and renewals effortless.</p> <p>My current setup on Digital Ocean's droplet uses the following:</p> <ul><li>Ubuntu 18.04.2 (check your OS version with <code>lsb_release -a</code>)</li> <li>Nginx (using server blocks)</li></ul> <p>You'll also need a fully registered domain name to certify, as well as having an A record pointing to your server's public IP address.</p> <div class="callout"><h3 class="callout__title">If you're looking to set up a LEMP stack, Digital Ocean provides great walkthroughs here:</h3> <p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-linux-nginx-mysql-php-lemp-stack-ubuntu-18-04" target="_blank" rel="noopener noreferrer">How To Install Linux, Nginx, MySQL, PHP (LEMP stack) on Ubuntu 18.04<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <p><a href="https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04" target="_blank" rel="noopener noreferrer">How To Install Nginx on Ubuntu 18.04 | DigitalOcean<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <h3 id="step-1-set-up-certbot"><a href="#step-1-set-up-certbot" aria-hidden="true" class="header-anchor">#</a> Step 1. Set up Certbot</h3> <p>Let's first add the repo, update the package list and install Certbot with:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> add-apt-repository ppa:certbot/certbot
<span class="token function">sudo</span> <span class="token function">apt-get</span> update
<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python-certbot-nginx
</code></pre></div><p>Once installed, we're ready to move on to the next step of certifying your domain.</p> <h3 id="step-2-set-up-nginx"><a href="#step-2-set-up-nginx" aria-hidden="true" class="header-anchor">#</a> Step 2. Set up nginx</h3> <p>We'll first need to see how your server name is configured by opening up the config file:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">nano</span> /etc/nginx/sites-available/yoursite.com
</code></pre></div><p>Once the file is open, look for the <code>server_name</code> field, which should look something like:</p> <div class="language- extra-class"><pre class="language-text"><code>server_name yoursite.com www.yoursite.com;
</code></pre></div><p>Save any changes you've made and exit out of the editor. Before we move onto the next step, we should check the syntax of our updated configuration file to make sure all is still under working order.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> nginx -t
</code></pre></div><p>If all looks good, then we'll need to restart nginx using <code>sudo systemctl reload nginx</code>.</p> <h3 id="step-3-obtain-a-ssl-certificate"><a href="#step-3-obtain-a-ssl-certificate" aria-hidden="true" class="header-anchor">#</a> Step 3. Obtain a SSL certificate</h3> <p>To get your domain certified for SSL, we'll start with this command:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> certbot --nginx -d yoursite.com -d www.yoursite.com
</code></pre></div><p>That command will run Certbot using the nginx plugin, specifying the names we're using to validate the certificate on. If you're running Certbot for the first time, it'll ask for your email and to agree to their terms of service. Once entered, Certbot will hit the Let's Encrypt server and ask how you'd like to configue your HTTPS settings.</p> <div class="language- extra-class"><pre class="language-text"><code>Output
Please choose whether or not to redirect HTTP traffic to HTTPS, removing HTTP access.
-------------------------------------------------------------------------------
1: No redirect - Make no further changes to the webserver configuration.
2: Redirect - Make all requests redirect to secure HTTPS access. Choose this for
new sites, or if you're confident your site works on HTTPS. You can undo this
change by editing your web server's configuration.
-------------------------------------------------------------------------------
Select the appropriate number [1-2] then [enter] (press 'c' to cancel):
</code></pre></div><p>The options provided will be between automatic redirection to force HTTPS access vs keeping the current state without forced redirection.</p> <p>Once a selection has been made, the configuration will be updated and nginx will reload. At this point, you can reload your site using <code>https://</code> which should reflect that the site is now secure through a green lock icon. Additionally, you can use <a href="https://www.ssllabs.com/ssltest/" target="_blank" rel="noopener noreferrer">SSL Lab Server Test<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> to test your server settings which should have an <strong>A</strong> grade.</p> <p>Next, we want to confirm Certbot will renew the default 90 day certification. The renewal process will ensure that your certificates will be automatically renewed for any certificate due to expire within 30 days. To test this process, do a dry run Certbot using:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> certbot renew --dry-run
</code></pre></div><p>If there are no errors reported, you can rest assure that your certificate will automatically be renewed and nginx will reload to reflect the changes. Any failures will be reported to the email address that was originally provided.</p> <hr> <h2 id="frequently-used-commands"><a href="#frequently-used-commands" aria-hidden="true" class="header-anchor">#</a> Frequently Used Commands</h2> <p><strong>Find the location of your php.ini file</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>php -i <span class="token operator">|</span> <span class="token function">grep</span> php.ini
</code></pre></div><p><strong>Restart php</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code>systemctl restart php7.2-fpm.service
</code></pre></div><p><strong>Restart a droplet from command line</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">shutdown</span> -r now
</code></pre></div><p><strong>Reset permissions</strong></p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">chown</span> -R www-data:www-data <span class="token punctuation">[</span>folder<span class="token punctuation">]</span>/
<span class="token function">chmod</span> -R <span class="token number">744</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div></div> <!----> <footer class="footer" data-v-57cf7cdc><div class="footer__inner" data-v-57cf7cdc><div class="signoff" data-v-57cf7cdc>© 2019 Kamicrafted. All rights reserved.</div> <div class="social" data-v-57cf7cdc><a href="http://kamicrafted.com/" data-v-57cf7cdc><i data-feather="globe" class="icon icon-globe" data-v-57cf7cdc></i></a> <a href="https://github.com/kamicrafted/" data-v-57cf7cdc><i data-feather="github" class="icon icon-github" data-v-57cf7cdc></i></a> <a href="https://instagram.com/kamicrafted" data-v-57cf7cdc><i data-feather="instagram" class="icon icon-instagram" data-v-57cf7cdc></i></a> <a href="https://facebook.com/rasterboy" data-v-57cf7cdc><i data-feather="facebook" class="icon icon-facebook" data-v-57cf7cdc></i></a></div></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c1aa11cd.js" defer></script><script src="/assets/js/6.580d02f8.js" defer></script><script src="/assets/js/14.743a4d6c.js" defer></script>
  </body>
</html>
